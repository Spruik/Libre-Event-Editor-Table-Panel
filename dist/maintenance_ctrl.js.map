{"version":3,"sources":["../src/maintenance_ctrl.js"],"names":["utils","moment","camunda","MaintenanceCtrl","ctrl","init","prepare","currentEvent","record","form","requestComment","category","duration","durationFormat","line","area","site","meta","isSending","sendBtnMsg","lineCombined","join","equipment","split","reason","status","machinestate","time","format","eventComment","comment","showModal","enableSending","result","postMsg","ok","alert","closeForm","error","console","log","disableSending","setTimeout","document","querySelector","click"],"mappings":"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","file":"maintenance_ctrl.js","sourcesContent":["import * as utils from './utils'\nimport moment from 'moment'\nimport * as camunda from './camundaAPI'\n\nexport class MaintenanceCtrl {\n  /** @ngInject */\n  constructor(ctrl) {\n    this.init(ctrl)\n    this.prepare()\n  } \n\n  init(ctrl) {\n    this.currentEvent = ctrl.currentEvent.record\n    this.form = {\n      requestComment: '',\n      category: this.currentEvent.category,\n      duration: this.currentEvent.durationFormat,\n      line: this.currentEvent.line,\n      area: this.currentEvent.area,\n      site: this.currentEvent.site,\n      meta: {\n        isSending: false\n      },\n      sendBtnMsg: 'Send'\n    }\n  }\n\n  prepare() {\n    this.form.lineCombined = [this.currentEvent.site, this.currentEvent.area, this.currentEvent.line].join(' | ')\n    this.form.equipment = this.currentEvent.equipment || 'Unknown'\n    this.form.equipment = this.form.equipment.split(' | ')[1] || this.form.equipment.split(' | ')[0]\n    this.form.reason = this.currentEvent.reason || 'Unknown'\n    if(!this.currentEvent.status) {\n      this.form.status = this.currentEvent.machinestate || 'Unknown'\n    } else {\n      this.form.status = this.currentEvent.status\n    }\n    this.form.time = moment(this.currentEvent.time).format('YYYY-MM-DD HH:mm:ss')\n    this.form.eventComment = this.currentEvent.comment || ''\n  }\n\n  show() {\n    utils.showModal('maintenanceRequestComment.html', this)\n  }\n\n  async onSend() {\n\n    this.enableSending()\n    \n    const result = await camunda.postMsg(this.form)\n    \n    if (result.ok) {\n      utils.alert('success', 'Successful', `The event has been successfully splitted`)\n      this.closeForm()\n    } else {\n      utils.alert('error', 'Error', `Unexpected error occurred when sending the maintenance request due to ${result.error}, please try again or contact the dev team`)\n      this.closeForm()\n      console.log(result.error)\n    }\n\n  }\n\n  process() {\n    return {\n\n    }\n  }\n\n  closeForm() {\n    this.disableSending()\n    setTimeout(() => {\n      document.querySelector('#edit-maintenance-request-comment-close-btn').click()\n    }, 0);\n  }\n\n  enableSending() {\n    this.form.meta.isSending = true\n    this.form.sendBtnMsg = 'Sending... '\n  }\n\n  disableSending() {\n    this.form.meta.isSending = false\n    this.form.sendBtnMsg = 'Send'\n  }\n\n}"]}