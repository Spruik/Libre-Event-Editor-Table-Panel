{"version":3,"sources":["../src/split_event_form.js"],"names":["utils","influx","moment","slider","SplitEventCtrl","ctrl","init","prepare","panelCtrl","currentEvent","editForm","splitForm","meta","isSplittingLeft","isEditing","isSaving","tempVal","saveBtnMsg","min","Date","record","time","getTime","max","add","duration","valueOf","value","splitInput","getDateTime","targetTime","nextTime","category","isValidVal","reasons","length","join","cateReaText","equipment","comment","showModal","$","step","tooltip","formatter","val","css","on","obj","newVal","newValue","result","event","id","target","splitLeft","splitRight","temp","dateTime","isNaN","alert","parseInt","panel","measurementOK","enableSaving","newTimestamp","split","endPoint","ok","closeForm","refresh","error","console","log","disableSaving","setTimeout","document","querySelector","click","timestamp","monthDate","getDate","slice","month","getMonth","year","getFullYear","date","hrs","getHours","mins","getMinutes","seconds","getSeconds","milSec","getMilliseconds"],"mappings":"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","file":"split_event_form.js","sourcesContent":["import * as utils from './utils';\nimport * as influx from './influxAPI';\nimport moment from 'moment';\nimport slider from './libs/bootstrap-slider';\n\nexport class SplitEventCtrl {\n\t/** @ngInject */\n\tconstructor(ctrl) {\n\t\tthis.init(ctrl);\n\t\tthis.prepare();\n\t}\n\n\tinit(ctrl) {\n\t\tthis.panelCtrl = ctrl.panelCtrl;\n\t\tthis.currentEvent = ctrl.currentEvent;\n\t\tthis.editForm = ctrl.editForm;\n\t\tthis.splitForm = {\n\t\t\tmeta: {\n\t\t\t\tisSplittingLeft: true,\n\t\t\t\tisEditing: false,\n\t\t\t\tisSaving: false,\n\t\t\t\ttempVal: null\n\t\t\t},\n\t\t\tsaveBtnMsg: 'Save'\n\t\t};\n\t}\n\n\tprepare() {\n\t\tthis.splitForm.min = new Date(this.currentEvent.record.time).getTime();\n\t\tthis.splitForm.max = moment(this.splitForm.min).add(this.currentEvent.record.duration).valueOf();\n\t\tthis.splitForm.value = this.splitForm.min + (this.splitForm.max - this.splitForm.min) / 2;\n\t\tthis.splitForm.splitInput = this.getDateTime(this.splitForm.value);\n\t\tthis.splitForm.targetTime = this.getDateTime(this.splitForm.min);\n\t\tthis.splitForm.nextTime = this.getDateTime(this.splitForm.max);\n\t\tthis.splitForm.category = utils.isValidVal(this.editForm.category) ? this.editForm.category : 'No Category';\n\t\tthis.splitForm.reasons = this.editForm.reasons.length !== 0 ? this.editForm.reasons.join(' | ') : 'No Reasons';\n\t\tthis.splitForm.cateReaText =\n\t\t\tthis.splitForm.category === 'No Category'\n\t\t\t\t? 'No Category'\n\t\t\t\t: `${this.splitForm.category} - ${this.splitForm.reasons}`;\n\t\tthis.splitForm.equipment = this.editForm.equipment;\n\t\tthis.splitForm.comment = this.editForm.comment;\n\t}\n\n\tshow() {\n\t\tutils.showModal('split_event_form.html', this, 'confirm-modal event-split-form-modal');\n\t}\n\n\tenableSlider() {\n\t\tlet slider = $('#event-editor-table-split-slider').slider({\n\t\t\tmin: this.splitForm.min,\n\t\t\tmax: this.splitForm.max,\n\t\t\tvalue: this.splitForm.value,\n\t\t\tstep: 1,\n\t\t\ttooltip: 'hide',\n\t\t\tformatter: (val) => {\n\t\t\t\treturn this.getDateTime(val);\n\t\t\t}\n\t\t});\n\n\t\t$('#ex1Slider .slider-selection').css('background', '#4cd964');\n\n\t\tslider.on('change', (obj) => {\n\t\t\tconst newVal = obj.value.newValue;\n\t\t\tconst result = this.getDateTime(newVal);\n\t\t\tthis.splitForm.splitInput = result;\n\t\t\t$('#event-split-input').val(result);\n\t\t});\n\t}\n\n\tonSplitChange(event) {\n\t\tconst id = event.target.id;\n\t\tif (id === 'left') {\n\t\t\tthis.splitLeft();\n\t\t} else {\n\t\t\tthis.splitRight();\n\t\t}\n\t}\n\n\tonTopBoxSave() {\n\t\tconst temp = this.splitForm.meta.tempVal;\n\t\tconst val = this.splitForm.splitInput;\n\n\t\tconst dateTime = new Date(val).getTime();\n\t\tif (isNaN(dateTime)) {\n\t\t\tthis.splitForm.splitInput = temp;\n\t\t\tutils.alert(\n\t\t\t\t'warning',\n\t\t\t\t'Warning',\n\t\t\t\t'The date time entered is not in a correct format, please follow the original format'\n\t\t\t);\n\t\t} else {\n\t\t\tif (val.length < 19) {\n\t\t\t\tthis.splitForm.splitInput = temp;\n\t\t\t\tutils.alert('warning', 'Warning', 'Please at least provide precision of seconds');\n\t\t\t} else if (val.length > 23) {\n\t\t\t\tthis.splitForm.splitInput = temp;\n\t\t\t\tutils.alert('warning', 'Warning', 'Precision can only be up to milliseconds');\n\t\t\t} else {\n\t\t\t\tif (dateTime < this.splitForm.min || dateTime > this.splitForm.max) {\n\t\t\t\t\tthis.splitForm.splitInput = temp;\n\t\t\t\t\tutils.alert('warning', 'Warning', 'The date time entered is out of range');\n\t\t\t\t} else {\n\t\t\t\t\t//OK\n\t\t\t\t\tthis.splitForm.meta.isEditing = false;\n\t\t\t\t\t$('#event-editor-table-split-slider').slider('setValue', parseInt(dateTime));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tonTopBoxCancel() {\n\t\tthis.splitForm.splitInput = this.splitForm.meta.tempVal;\n\t\tthis.splitForm.meta.isEditing = false;\n\t}\n\n\tasync onFormSave() {\n\t\tif (!this.panelCtrl.panel.measurementOK) {\n\t\t\tutils.alert(\n\t\t\t\t'warning',\n\t\t\t\t'Warning',\n\t\t\t\t\"The measurement you put in the Down Time Panel may be invalid, please make sure it matches the one that's in the query\"\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.enableSaving();\n\n\t\tconst newTimestamp = $('#event-editor-table-split-slider').slider('getValue') * 1000000;\n\t\tconst result = await influx.split(\n\t\t\tnewTimestamp,\n\t\t\tthis.currentEvent,\n\t\t\tthis.splitForm,\n\t\t\tthis.panelCtrl.panel.endPoint\n\t\t);\n\n\t\tif (result.ok) {\n\t\t\tutils.alert('success', 'Successful', `The event has been successfully splitted`);\n\t\t\tthis.closeForm();\n\t\t\tthis.panelCtrl.refresh();\n\t\t} else {\n\t\t\tutils.alert(\n\t\t\t\t'error',\n\t\t\t\t'Error',\n\t\t\t\t`Unexpected error occurred when splitting this event due to ${result.error}, please try agian or contact the dev team`\n\t\t\t);\n\t\t\tthis.closeForm();\n\t\t\tconsole.log(result.error);\n\t\t}\n\t}\n\n\tsplitLeft() {\n\t\tthis.splitForm.meta.isSplittingLeft = true;\n\t\t$('#ex1Slider .slider-selection').css('background', '#4cd964');\n\t\t$('#ex1Slider .slider-track-high').css('background', '');\n\t}\n\n\tsplitRight() {\n\t\tthis.splitForm.meta.isSplittingLeft = false;\n\t\t$('#ex1Slider .slider-selection').css('background', '');\n\t\t$('#ex1Slider .slider-track-high').css('background', '#eb972a');\n\t}\n\n\tcloseForm() {\n\t\tthis.disableSaving();\n\t\tsetTimeout(() => {\n\t\t\tdocument.querySelector('#eetp-split-form-closeBtn').click();\n\t\t}, 0);\n\t}\n\n\tenableSaving() {\n\t\tthis.splitForm.meta.isSaving = true;\n\t\tthis.splitForm.saveBtnMsg = 'Saving... ';\n\t}\n\n\tdisableSaving() {\n\t\tthis.splitForm.meta.isSaving = false;\n\t\tthis.splitForm.saveBtnMsg = 'Save';\n\t}\n\n\tgetDateTime(timestamp) {\n\t\tconst monthDate = ('0' + new Date(timestamp).getDate()).slice(-2);\n\t\tconst month = ('0' + (new Date(timestamp).getMonth() + 1)).slice(-2);\n\t\tconst year = new Date(timestamp).getFullYear();\n\t\tlet date = year + '-' + month + '-' + monthDate;\n\n\t\tlet hrs = ('0' + new Date(timestamp).getHours()).slice(-2);\n\t\tlet mins = ('0' + new Date(timestamp).getMinutes()).slice(-2);\n\t\tlet seconds = ('0' + new Date(timestamp).getSeconds()).slice(-2);\n\t\tlet milSec = new Date(timestamp).getMilliseconds();\n\t\tlet time = hrs + ':' + mins + ':' + seconds + '.' + milSec;\n\n\t\tlet dateTime = date + ' ' + time;\n\t\treturn dateTime;\n\t}\n}\n"]}