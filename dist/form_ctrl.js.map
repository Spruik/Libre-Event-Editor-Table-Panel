{"version":3,"sources":["../src/form_ctrl.js"],"names":["saveForm","data","timestamp","equipment","filter","d","name","value","category","comment","length","utils","alert","reasons","includes","reduce","arr","r","push","reason","join","parentReason","line","writeInfluxLine","url","influxHost","post","then","$","trigger","catch","console","log","e","rowData","Site","Area","Line","stopped","idle","execute","held","complete","status","duration","undefined","showForm","influxUrl","postgresUrl","postgRestHost","get","handleData","equipmentRes","res","categoryRes","popUpOptionModal","removeOptionListeners","addOptionListeners","appEvents","emit","src","modalClass","model","document","off","on","target","id","popUpModal","removeListeners","addListeners","processedData","processData","removeRequestListeners","addRequestListeners","text","val","requestComment","camApi","postMsg","rowdata","time","moment","format","area","site","split","eventComment","retryTimes","showCate","setTimeout","showCategories","categories","cat","category_id","reason_id","parent_reason_id","categoriesGroup","forEach","append","renderCategory","c","insertBefore","inArray","slider","min","max","enableInstantSearch","showEmptyMsg","group","influxRes","results","series","cols","columns","vals","values","o","row","i","nextData","equipmentUrl","input_container","input","radio_tile_group","label","showReasons","isFirstLevel","level","upperReasonsGroup","currentCategorySelected","parseInt","parentElement","rea","reasonsGroup","separator","title","renderReason","insertAfter","appendTarget","checkSelectedReasons","config_reasons","selectedReasons","remove","reasonGroup","removeNext","nextElementSibling","serializeArray","checkEquipment","showSplitForm","isEquipmentValid","equip","production_line","indexOf","next","className"],"mappings":"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","file":"form_ctrl.js","sourcesContent":["import { appEvents } from 'app/core/core'\nimport { showSplitForm } from './split_event_form'\nimport * as utils from './utils'\nimport * as camApi from './camundaAPI'\nimport moment from 'moment'\nimport { enableInstantSearch } from './instant_search_ctrl'\nimport slider from './libs/bootstrap-slider'\n\nlet categoryRes\nlet equipmentRes\nlet rowData = {}\nlet nextData;\nlet currentCategorySelected\n\nfunction saveForm (data, timestamp) {\n  \n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n\n  const category = data.filter(d => d.name === 'category')\n  \n  const comment = data.filter(d => d.name === 'comment')[0].value\n  \n  if (!category.length > 0) {\n    utils.alert('warning', 'Warning', 'Please select a category')\n    return\n  }\n  let reasons = data.filter(d => d.name.includes('reasons-'))\n  reasons = reasons.reduce((arr, r) => {\n    arr.push(r.value)\n    return arr\n  }, [])\n  const reason = reasons.join(' | ')\n  const parentReason = reasons[0]\n\n  const line = writeInfluxLine(category[0].value, parentReason, reason, comment, timestamp, equipment)\n//   console.log(line);\n  \n  let url = utils.influxHost + 'write?db=smart_factory'\n  utils.post(url, line)\n    .then(res => {\n    //   console.log(res)\n      //save success. close the form\n      $('#event-editor-form-cancelBtn').trigger('click')\n      utils.alert('success', 'Success', 'database successfully updated')\n    })\n    .catch(e => {\n      console.log(e)\n      utils.alert('error', 'Error', 'Unexpected error occurred whiling updating the influx database, please try again')\n    })\n}\n\n/**\n * Write query line to update the selected record influxdb\n */\nfunction writeInfluxLine (category, parentReason, reason, comment, timestamp, equipment) {\n  let line = 'Availability,Site=' + rowData.Site + ',Area=' + rowData.Area + ',Line=' + rowData.Line + ' '\n\n  line += 'stopped=' + rowData.stopped + ','\n  line += 'idle=' + rowData.idle + ','\n  line += 'execute=' + rowData.execute + ','\n  line += 'held=' + rowData.held + ','\n  line += 'complete=' + rowData.complete + ','\n  line += 'status=\"' + rowData.status + '\"' + ','\n\n  if (rowData.duration !== null && rowData.duration !== undefined) {\n    line += 'duration=\"' + rowData.duration + '\"' + ','\n  }\n  if (comment !== '' && comment !== undefined) {\n    line += 'comment=\"' + comment + '\"' + ','\n  }\n  if (equipment !== '' && equipment !== undefined) {\n    line += 'equipment=\"' + equipment + '\"' + ','\n  }\n  line += 'parentReason=\"' + parentReason + '\"' + ','\n  line += 'category=\"' + category + '\"' + ','\n  line += 'reason=\"' + reason + '\"' + ' '\n  line += timestamp\n\n//   console.log(line);\n  return line\n}\n\n/**\n * Send query req to influxdb and postgresql in order to show form contents.\n */\nexport function showForm (timestamp) {\n  //console.log(timestamp)\n  let influxUrl = utils.influxHost + 'query?pretty=true&db=smart_factory&q=select * from Availability where time >= ' + timestamp + ' limit 2'\n  let postgresUrl = utils.postgRestHost + 'reason_codes'\n\n  // send query requests\n  utils.get(influxUrl)\n    .then(handleData)\n    .then(url =>\n      utils.get(url)\n        .then(res => {\n          equipmentRes = res\n        }).then(utils.get(postgresUrl)\n            .then(res => {\n                categoryRes = res\n                popUpOptionModal(timestamp)\n            })\n          ).catch(e => {\n            utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n            console.log(e)\n          })\n        .catch(e => {\n          utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n          console.log(e)\n        })\n    )\n    .catch(e => {\n        utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n      console.log(e)\n    })\n\n  // remove all listeners\n  removeOptionListeners()\n  // add listeners\n  addOptionListeners(timestamp)\n}\n\nfunction popUpOptionModal () {\n  appEvents.emit('show-modal', {\n    src: 'public/plugins/smart-factory-event-editor-table-panel/partials/popup_options_form.html',\n    modalClass: 'editOrMaintenance-modal',\n    model: {}\n  })\n}\n\nfunction removeOptionListeners() {\n  $(document).off('click', 'input[type=\"radio\"][name=\"edit-maintain-radio\"]')\n}\n\nfunction addOptionListeners(timestamp) {\n\n  $(document).on('click', 'input[type=\"radio\"][name=\"edit-maintain-radio\"]', e => {\n    \n    if (e.target.id === 'edit') {\n      //popup editor\n      popUpModal(timestamp)\n      // remove all listeners\n      removeListeners()\n      // add listeners\n      addListeners(timestamp)\n    }else if (e.target.id === 'maintain') {\n      //if no data, tell the user and open up the editor\n      if (!rowData.category) {\n        utils.alert('warning', 'Reason Codes Not Found', 'Please specify reason codes for this event before requesting maintenance')\n        //popup editor\n        popUpModal(timestamp)\n        // remove all listeners\n        removeListeners()\n        // add listeners\n        addListeners(timestamp)\n      }else {\n        //if there is data\n        const processedData = processData(rowData)\n        appEvents.emit('show-modal', {\n          src: 'public/plugins/smart-factory-event-editor-table-panel/partials/maintenanceRequestComment.html',\n          modalClass: 'confirm-modal',\n          model: {}\n        })\n        // remove all listeners\n        removeRequestListeners()\n        // add listeners\n        addRequestListeners(processedData)\n      }\n    }\n  })\n}\n\nfunction removeRequestListeners() {\n  $(document).off('click', 'button#event-editor-form-maintenance-request-sendBtn')\n}\n\nfunction addRequestListeners(processedData) {\n  $(document).on('click', 'button#event-editor-form-maintenance-request-sendBtn', function (){\n    const text = $('#edit-maintenance-request-text').val()\n    processedData.requestComment = text\n    camApi.postMsg(processedData)\n    $('#edit-maintenance-request-comment-close-btn').trigger('click')\n  })\n}\n\nfunction processData (rowdata) {\n  const time = moment(rowdata.time).format('YYYY-MM-DD HH:mm:ss')\n  const equipment = rowdata.equipment || \"Unknown | Unknown\"\n  const reason = rowdata.reason || \"Unknown\"\n  const comment = rowdata.comment || \"\"\n\n  return {\n    area: rowdata.Area,\n    site: rowdata.Site,\n    line: rowdata.Line,\n    category: rowdata.category,\n    duration: rowdata.duration.split('.')[0],\n    equipment: equipment.split(' | ')[1],\n    reason: reason,\n    status: rowdata.status,\n    eventComment: comment,\n    time: time\n  }\n}\n\n/**\n * Popup the event editor form modal and pass the timestamp into the html as for the form_id\n * and then show categories\n */\nlet retryTimes = 1\nfunction popUpModal (timestamp) {\n  appEvents.emit('show-modal', {\n    src: 'public/plugins/smart-factory-event-editor-table-panel/partials/event_editor_form.html',\n    modalClass: 'confirm-modal event-editor-form-modal scroll',\n    model: { timestamp: timestamp }\n  })\n\n  // set timeout to make sure the DOM exist in order to append categories\n  retryTimes = 1\n  showCate()\n}\n\nfunction showCate(){\n  setTimeout(() => {\n    try{\n      showCategories()\n    }catch (e) {\n      console.log(e);\n      if (retryTimes > 15) {\n        $('#event-editor-form-cancelBtn').trigger('click')\n        utils.alert('error', 'Error', 'Editor Form init failed due to the form trying to initialise and at the same time the page being refreshing, please try agian')\n      }else {\n        // console.log('Editor Form init failed due to the page being refreshing, re-initialising...the ' + retryTimes + 'th time');\n        showCate()\n        retryTimes ++\n      }\n    }\n  }, 200);\n}\n\n/**\n * As the modal is popped up, meaning that the html DOM is now existing. Show content dynamically based on categoryRes\n * And then add\n */\nfunction showCategories () {\n  // category is the top level, there shouldn't be reason_id and parent_reason_id\n  let categories = categoryRes.filter(\n    cat =>\n      cat.category_id !== null &&\n      cat.reason_id === null &&\n      cat.parent_reason_id === null\n  )\n  categories = categories.reduce((arr, cat) => {\n    arr.push(cat.category_id)\n    return arr\n  }, [])\n  let categoriesGroup = $('<div class=\"radio-tile-group\"></div>')\n  categories.forEach(c => {\n    categoriesGroup.append(renderCategory(c))\n  })\n  let target = $('div.target-being-below-categories')\n  categoriesGroup.insertBefore(target)\n  //console.log(categories)\n\n  // check if category already exist, if yes, select it\n  if (rowData.category !== null) {\n    // check if category in categories arr\n    if ($.inArray(rowData.category, categories) !== -1) {\n      // inArray function returns -1 if false, !== -1 means it exists\n      $('input[type=radio][name=category][value=' + '\"' + rowData.category + '\"' + ']').trigger('click')\n    }\n  }\n\n  //display comment if there is\n  if (rowData.comment !== null && rowData.comment !== undefined && rowData.comment !== '') {\n    $('#editor-form-comment-area').text(rowData.comment)\n  }\n\n  //just for testing if the form can start successfully, \n  //if not, the slider.on will thorw err, then will catch it to restart the form\n  let slider = $('#event-split-slider1').slider({\n    min: 1,\n    max: 20,\n    value: 18,\n  })\n  slider.on('change', obj => {\n  })\n\n  if (rowData.equipment !== \"\" && rowData.equipment !== null && rowData.equipment !== undefined) {\n    $('input#eet-datalist-input-equipment').val(rowData.equipment)\n  }\n\n  //init the datalist for equipment\n  enableInstantSearch(equipmentRes)\n\n  if (categoryRes.length === 0) {\n    showEmptyMsg()\n  }\n}\n\nfunction showEmptyMsg(){\n  $('div#category-div-id').text('')\n  let group = $('<p>No reason codes were found, you can add reason codes from the <strong>Reason Codes Tree Panel</strong></p>')\n  let target = $('div.target-being-below-categories')\n  group.insertBefore(target)\n}\n\n/**\n * Make the response row data from the influxdb into one single object for better use\n * Then use the site, area and line attr from the rowData as the keys to get make up a query url then retrun it\n */\nfunction handleData (res) {\n  let influxRes = res.results[0].series[0]\n  let cols = influxRes.columns\n  let vals = influxRes.values\n  let data = []\n  for (let o = 0; o < vals.length; o++) {\n    let row = {}\n    for (let i = 0; i < cols.length; i++) {\n      row[cols[i]] = vals[o][i]\n    }\n    data.push(row)\n  }\n  rowData = data[0]\n  nextData = data.length === 2 ? data[1] : {}\n  // console.log('next record is empty ? --> ' + $.isEmptyObject(nextData))\n  let equipmentUrl = utils.postgRestHost + 'equipment?production_line=eq.' + rowData.Line + '&equipment=not.is.null'\n  return equipmentUrl\n}\n\n/**\n * Make up a single category box with the category passed in, and then return the box.\n */\nfunction renderCategory (category) {\n  let input_container = $('<div class=\"input-container categories-input-container\">')\n  let input = $('<input id=\"' + category + '\" class=\"radio-button\" type=\"radio\" name=\"category\" value=\"' + category + '\" />')\n  let radio_tile_group = $('<div class=\"radio-tile\"></div>')\n  let label = $('<label for=\"' + category + '\" class=\"radio-tile-label\">' + category + '</label>')\n\n  radio_tile_group.append(label)\n  input_container.append(input).append(radio_tile_group)\n\n  return input_container\n}\n\n/**\n * Show the reasons\n * and then append to the DOM\n * NOTE: if is first, target var passed in is a string. else, target passed in is an object\n */\nfunction showReasons (target, isFirstLevel) {\n  let reasons\n  let level\n  let upperReasonsGroup\n\n  if (isFirstLevel) {\n    // is the first level\n    // category = target, reasonid !== null and parentid === null\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === target &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === null\n    )\n    level = 1\n  } else {\n    // is lower level\n    // category = global_currentCategorySelected, reasonsid !== null and parentid === target.value\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === currentCategorySelected &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === target.value\n    )\n    // level +1 based on the upper one\n    level = parseInt(target.name.split('-')[1]) + 1\n    upperReasonsGroup = target.parentElement.parentElement\n  }\n\n  reasons = reasons.reduce((arr, rea) => {\n    arr.push(rea.reason_id)\n    return arr\n  }, [])\n  //console.log(reasons)\n\n  if (reasons.length === 0) return\n\n  let reasonsGroup = $('<div class=\"switch-field\"></div>')\n\n  if (level !== 1) {\n    let separator = $('<div class=\"custom-separator\"></div>')\n    reasonsGroup.append(separator)\n  }\n\n  let title = $('<div class=\"switch-title\">Reason Level ' + level + '</div>')\n  reasonsGroup.append(title)\n\n  reasons.forEach(r => {\n    reasonsGroup.append(renderReason(r, level))\n  })\n\n  if (level !== 1) {\n    reasonsGroup.insertAfter(upperReasonsGroup)\n  } else {\n    let appendTarget = $('div.target-being-above-reason-level-1')\n    reasonsGroup.insertAfter(appendTarget)\n  }\n\n  checkSelectedReasons(level, reasons)\n}\n\n/**\n * Check if there is reasons that are already selected for each level\n * If there is seleceted reason and for that level, it can be found in the config reason arr, then trigger click\n */\nfunction checkSelectedReasons (level, config_reasons) {\n  // make sure the current selected category is the same with the recorded category to avoid unwanted results\n  if (currentCategorySelected === rowData.category) {\n    if (rowData.reason !== null) {\n      let selectedReasons = rowData.reason.split(' | ')\n      if (selectedReasons[level - 1] !== null) {\n        if ($.inArray(selectedReasons[level - 1], config_reasons) !== -1) {\n          $(`input[type=radio][name*='reasons-'][value=` + '\"' + selectedReasons[level - 1] + '\"' + `]`).trigger('click')\n        }\n      }\n    }\n  }\n}\n\n/**\n * Make up a single reason option with the reason passed in, and then return the option.\n */\nfunction renderReason (reason, level) {\n  let id = level + '-' + reason\n  let group = $('<div></div>')\n  let input = $('<input type=\"radio\" id=\"' + id + '\" name=\"reasons-' + level + '\" value=\"' + reason + '\"/>')\n  let label = $('<label for=\"' + id + '\">' + reason + '</label>')\n  group.append(input).append(label)\n  return group\n}\n\n/**\n * Add listener for categories and reasons\n */\nfunction addListeners (timestamp) {\n  // categories on selected, find reasons where cate_id = this.value && parent_id === null\n  $(document).on('change', 'input[type=radio][name=category]', e => {\n    // console.log(e.target.value)\n    currentCategorySelected = e.target.value\n    // must remove all reasons before show reasons\n    $('div.switch-field').remove()\n    showReasons(e.target.value, true)\n  })\n\n  $(document).on('change', \"input[type=radio][name*='reasons-']\", e => {\n    // console.log(e.target.value);\n\n    // before show reasons, must remove all reason levels that are below this target reason level\n    let reasonGroup = e.target.parentElement.parentElement\n    // Remove reason level one level by one level until it return false.\n    while (removeNext(reasonGroup.nextElementSibling)) {}\n\n    showReasons(e.target, false)\n  })\n\n  $(document).on('click', 'button#event-editor-form-saveBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    saveForm(data, timestamp);\n  })\n\n  $(document).on('click', 'button#event-editor-form-splitBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    $('.event-split-form-modal').remove()\n    showSplitForm(data, rowData, nextData)\n  })\n}\n\nfunction checkEquipment(data) {\n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n    //check for equipment input\n\n  if (!isEquipmentValid(equipment)) { \n    //equipment can be empty but if it's not empty it must be the same with the original one to ensure consistency\n    if (equipment !== \"\") { \n      utils.alert('warning', 'Warning', 'Equipment not found, please select it from the list or leave it empty')\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction isEquipmentValid(equipment) {\n  \n  const equip = equipmentRes.reduce((arr, e) => {\n    const text = e.production_line + ' | ' + e.equipment    \n    arr.push(text)\n    return arr\n  }, [])\n  if (equip.indexOf(equipment) === -1) {\n    return false\n  }\n  return true\n}\n\nfunction removeListeners () {\n  $(document).off('change', 'input[type=radio][name=category]')\n  $(document).off('change', \"input[type=radio][name*='reasons-']\")\n  $(document).off('click', 'button#event-editor-form-saveBtn')\n  $(document).off('click', 'button#event-editor-form-splitBtn')\n}\n\n/**\n * Remove Div named 'switch-field', which is one level of reasons\n */\nfunction removeNext (next) {\n  if (next.className === 'switch-field') {\n    next.remove()\n    return true\n  } else {\n    return false\n  }\n}"]}