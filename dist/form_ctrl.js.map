{"version":3,"sources":["../src/form_ctrl.js"],"names":["saveForm","data","timestamp","equipment","filter","d","name","value","category","comment","length","utils","alert","reasons","includes","reduce","arr","r","push","reason","join","parentReason","line","writeInfluxLine","url","influxHost","post","then","$","trigger","catch","console","log","e","rowData","Site","Area","Line","stopped","idle","execute","held","complete","status","duration","undefined","showForm","influxUrl","postgresUrl","postgRestHost","get","handleData","equipmentRes","res","categoryRes","popUpModal","removeListeners","addListeners","appEvents","emit","src","modalClass","model","retryTimes","showCate","setTimeout","showCategories","categories","cat","category_id","reason_id","parent_reason_id","categoriesGroup","forEach","append","renderCategory","c","target","insertBefore","inArray","text","slider","min","max","on","val","enableInstantSearch","showEmptyMsg","group","influxRes","results","series","cols","columns","vals","values","o","row","i","nextData","equipmentUrl","input_container","input","radio_tile_group","label","showReasons","isFirstLevel","level","upperReasonsGroup","currentCategorySelected","parseInt","split","parentElement","rea","reasonsGroup","separator","title","renderReason","insertAfter","appendTarget","checkSelectedReasons","config_reasons","selectedReasons","id","document","remove","reasonGroup","removeNext","nextElementSibling","serializeArray","checkEquipment","showSplitForm","isEquipmentValid","equip","production_line","indexOf","off","next","className"],"mappings":"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","file":"form_ctrl.js","sourcesContent":["import { appEvents } from 'app/core/core'\nimport { showSplitForm } from './split_event_form'\nimport * as utils from './utils'\nimport { enableInstantSearch } from './instant_search_ctrl'\nimport slider from './libs/bootstrap-slider'\n\n\n\nlet categoryRes\nlet equipmentRes\nlet rowData = {}\nlet nextData;\nlet currentCategorySelected\n\nfunction saveForm (data, timestamp) {\n  \n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n\n  const category = data.filter(d => d.name === 'category')\n  \n  const comment = data.filter(d => d.name === 'comment')[0].value\n  \n  if (!category.length > 0) {\n    utils.alert('warning', 'Warning', 'Please select a category')\n    return\n  }\n  let reasons = data.filter(d => d.name.includes('reasons-'))\n  reasons = reasons.reduce((arr, r) => {\n    arr.push(r.value)\n    return arr\n  }, [])\n  const reason = reasons.join(' | ')\n  const parentReason = reasons[0]\n\n  const line = writeInfluxLine(category[0].value, parentReason, reason, comment, timestamp, equipment)\n//   console.log(line);\n  \n  let url = utils.influxHost + 'write?db=smart_factory'\n  utils.post(url, line)\n    .then(res => {\n    //   console.log(res)\n      //save success. close the form\n      $('#event-editor-form-cancelBtn').trigger('click')\n      utils.alert('success', 'Success', 'database successfully updated')\n    })\n    .catch(e => {\n      console.log(e)\n      utils.alert('error', 'Error', 'Unexpected error occurred whiling updating the influx database, please try again')\n    })\n}\n\n/**\n * Write query line to update the selected record influxdb\n */\nfunction writeInfluxLine (category, parentReason, reason, comment, timestamp, equipment) {\n  let line = 'Availability,Site=' + rowData.Site + ',Area=' + rowData.Area + ',Line=' + rowData.Line + ' '\n\n  line += 'stopped=' + rowData.stopped + ','\n  line += 'idle=' + rowData.idle + ','\n  line += 'execute=' + rowData.execute + ','\n  line += 'held=' + rowData.held + ','\n  line += 'complete=' + rowData.complete + ','\n  line += 'status=\"' + rowData.status + '\"' + ','\n\n  if (rowData.duration !== null && rowData.duration !== undefined) {\n    line += 'duration=\"' + rowData.duration + '\"' + ','\n  }\n  if (comment !== '' && comment !== undefined) {\n    line += 'comment=\"' + comment + '\"' + ','\n  }\n  if (equipment !== '' && equipment !== undefined) {\n    line += 'equipment=\"' + equipment + '\"' + ','\n  }\n  line += 'parentReason=\"' + parentReason + '\"' + ','\n  line += 'category=\"' + category + '\"' + ','\n  line += 'reason=\"' + reason + '\"' + ' '\n  line += timestamp\n\n//   console.log(line);\n  return line\n}\n\n/**\n * Send query req to influxdb and postgresql in order to show form contents.\n */\nexport function showForm (timestamp) {\n  //console.log(timestamp)\n  let influxUrl = utils.influxHost + 'query?pretty=true&db=smart_factory&q=select * from Availability where time >= ' + timestamp + ' limit 2'\n  let postgresUrl = utils.postgRestHost + 'reason_codes'\n\n  // send query requests\n  utils.get(influxUrl)\n    .then(handleData)\n    .then(url =>\n      utils.get(url)\n        .then(res => {\n          equipmentRes = res\n        }).then(utils.get(postgresUrl)\n            .then(res => {\n                categoryRes = res\n                popUpModal(timestamp)\n            })\n          ).catch(e => {\n            utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n            console.log(e)\n          })\n        .catch(e => {\n          utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n          console.log(e)\n        })\n    )\n    .catch(e => {\n        utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from database, please try again')\n      console.log(e)\n    })\n\n  // remove all listeners\n  removeListeners()\n  // add listeners\n  addListeners(timestamp)\n}\n\n/**\n * Popup the event editor form modal and pass the timestamp into the html as for the form_id\n * and then show categories\n */\nlet retryTimes = 1\nfunction popUpModal (timestamp) {\n  appEvents.emit('show-modal', {\n    src: 'public/plugins/smart-factory-event-editor-table-panel/partials/event_editor_form.html',\n    modalClass: 'confirm-modal event-editor-form-modal scroll',\n    model: { timestamp: timestamp }\n  })\n\n  // set timeout to make sure the DOM exist in order to append categories\n  retryTimes = 1\n  showCate()\n}\n\nfunction showCate(){\n  setTimeout(() => {\n    try{\n      showCategories()\n    }catch (e) {\n      console.log(e);\n      if (retryTimes > 15) {\n        $('#event-editor-form-cancelBtn').trigger('click')\n        utils.alert('error', 'Error', 'Editor Form init failed due to the form trying to initialise and at the same time the page being refreshing, please try agian')\n      }else {\n        // console.log('Editor Form init failed due to the page being refreshing, re-initialising...the ' + retryTimes + 'th time');\n        showCate()\n        retryTimes ++\n      }\n    }\n  }, 200);\n}\n\n/**\n * As the modal is popped up, meaning that the html DOM is now existing. Show content dynamically based on categoryRes\n * And then add\n */\nfunction showCategories () {\n  // category is the top level, there shouldn't be reason_id and parent_reason_id\n  let categories = categoryRes.filter(\n    cat =>\n      cat.category_id !== null &&\n      cat.reason_id === null &&\n      cat.parent_reason_id === null\n  )\n  categories = categories.reduce((arr, cat) => {\n    arr.push(cat.category_id)\n    return arr\n  }, [])\n  let categoriesGroup = $('<div class=\"radio-tile-group\"></div>')\n  categories.forEach(c => {\n    categoriesGroup.append(renderCategory(c))\n  })\n  let target = $('div.target-being-below-categories')\n  categoriesGroup.insertBefore(target)\n  //console.log(categories)\n\n  // check if category already exist, if yes, select it\n  if (rowData.category !== null) {\n    // check if category in categories arr\n    if ($.inArray(rowData.category, categories) !== -1) {\n      // inArray function returns -1 if false, !== -1 means it exists\n      $('input[type=radio][name=category][value=' + '\"' + rowData.category + '\"' + ']').trigger('click')\n    }\n  }\n\n  //display comment if there is\n  if (rowData.comment !== null && rowData.comment !== undefined && rowData.comment !== '') {\n    $('#editor-form-comment-area').text(rowData.comment)\n  }\n\n  //just for testing if the form can start successfully, \n  //if not, the slider.on will thorw err, then will catch it to restart the form\n  let slider = $('#event-split-slider1').slider({\n    min: 1,\n    max: 20,\n    value: 18,\n  })\n  slider.on('change', obj => {\n  })\n\n  if (rowData.equipment !== \"\" && rowData.equipment !== null && rowData.equipment !== undefined) {\n    $('input#eet-datalist-input-equipment').val(rowData.equipment)\n  }\n\n  //init the datalist for equipment\n  enableInstantSearch(equipmentRes)\n\n  if (categoryRes.length === 0) {\n    showEmptyMsg()\n  }\n}\n\nfunction showEmptyMsg(){\n  $('div#category-div-id').text('')\n  let group = $('<p>No reason codes were found, you can add reason codes from the <strong>Reason Codes Tree Panel</strong></p>')\n  let target = $('div.target-being-below-categories')\n  group.insertBefore(target)\n}\n\n/**\n * Make the response row data from the influxdb into one single object for better use\n * Then use the site, area and line attr from the rowData as the keys to get make up a query url then retrun it\n */\nfunction handleData (res) {\n  let influxRes = res.results[0].series[0]\n  let cols = influxRes.columns\n  let vals = influxRes.values\n  let data = []\n  for (let o = 0; o < vals.length; o++) {\n    let row = {}\n    for (let i = 0; i < cols.length; i++) {\n      row[cols[i]] = vals[o][i]\n    }\n    data.push(row)\n  }\n  rowData = data[0]\n  nextData = data.length === 2 ? data[1] : {}\n  // console.log('next record is empty ? --> ' + $.isEmptyObject(nextData))\n  let equipmentUrl = utils.postgRestHost + 'equipment?production_line=eq.' + rowData.Line + '&equipment=not.is.null'\n  return equipmentUrl\n}\n\n/**\n * Make up a single category box with the category passed in, and then return the box.\n */\nfunction renderCategory (category) {\n  let input_container = $('<div class=\"input-container categories-input-container\">')\n  let input = $('<input id=\"' + category + '\" class=\"radio-button\" type=\"radio\" name=\"category\" value=\"' + category + '\" />')\n  let radio_tile_group = $('<div class=\"radio-tile\"></div>')\n  let label = $('<label for=\"' + category + '\" class=\"radio-tile-label\">' + category + '</label>')\n\n  radio_tile_group.append(label)\n  input_container.append(input).append(radio_tile_group)\n\n  return input_container\n}\n\n/**\n * Show the reasons\n * and then append to the DOM\n * NOTE: if is first, target var passed in is a string. else, target passed in is an object\n */\nfunction showReasons (target, isFirstLevel) {\n  let reasons\n  let level\n  let upperReasonsGroup\n\n  if (isFirstLevel) {\n    // is the first level\n    // category = target, reasonid !== null and parentid === null\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === target &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === null\n    )\n    level = 1\n  } else {\n    // is lower level\n    // category = global_currentCategorySelected, reasonsid !== null and parentid === target.value\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === currentCategorySelected &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === target.value\n    )\n    // level +1 based on the upper one\n    level = parseInt(target.name.split('-')[1]) + 1\n    upperReasonsGroup = target.parentElement.parentElement\n  }\n\n  reasons = reasons.reduce((arr, rea) => {\n    arr.push(rea.reason_id)\n    return arr\n  }, [])\n  //console.log(reasons)\n\n  if (reasons.length === 0) return\n\n  let reasonsGroup = $('<div class=\"switch-field\"></div>')\n\n  if (level !== 1) {\n    let separator = $('<div class=\"custom-separator\"></div>')\n    reasonsGroup.append(separator)\n  }\n\n  let title = $('<div class=\"switch-title\">Reason Level ' + level + '</div>')\n  reasonsGroup.append(title)\n\n  reasons.forEach(r => {\n    reasonsGroup.append(renderReason(r, level))\n  })\n\n  if (level !== 1) {\n    reasonsGroup.insertAfter(upperReasonsGroup)\n  } else {\n    let appendTarget = $('div.target-being-above-reason-level-1')\n    reasonsGroup.insertAfter(appendTarget)\n  }\n\n  checkSelectedReasons(level, reasons)\n}\n\n/**\n * Check if there is reasons that are already selected for each level\n * If there is seleceted reason and for that level, it can be found in the config reason arr, then trigger click\n */\nfunction checkSelectedReasons (level, config_reasons) {\n  // make sure the current selected category is the same with the recorded category to avoid unwanted results\n  if (currentCategorySelected === rowData.category) {\n    if (rowData.reason !== null) {\n      let selectedReasons = rowData.reason.split(' | ')\n      if (selectedReasons[level - 1] !== null) {\n        if ($.inArray(selectedReasons[level - 1], config_reasons) !== -1) {\n          $(`input[type=radio][name*='reasons-'][value=` + '\"' + selectedReasons[level - 1] + '\"' + `]`).trigger('click')\n        }\n      }\n    }\n  }\n}\n\n/**\n * Make up a single reason option with the reason passed in, and then return the option.\n */\nfunction renderReason (reason, level) {\n  let id = level + '-' + reason\n  let group = $('<div></div>')\n  let input = $('<input type=\"radio\" id=\"' + id + '\" name=\"reasons-' + level + '\" value=\"' + reason + '\"/>')\n  let label = $('<label for=\"' + id + '\">' + reason + '</label>')\n  group.append(input).append(label)\n  return group\n}\n\n/**\n * Add listener for categories and reasons\n */\nfunction addListeners (timestamp) {\n  // categories on selected, find reasons where cate_id = this.value && parent_id === null\n  $(document).on('change', 'input[type=radio][name=category]', e => {\n    // console.log(e.target.value)\n    currentCategorySelected = e.target.value\n    // must remove all reasons before show reasons\n    $('div.switch-field').remove()\n    showReasons(e.target.value, true)\n  })\n\n  $(document).on('change', \"input[type=radio][name*='reasons-']\", e => {\n    // console.log(e.target.value);\n\n    // before show reasons, must remove all reason levels that are below this target reason level\n    let reasonGroup = e.target.parentElement.parentElement\n    // Remove reason level one level by one level until it return false.\n    while (removeNext(reasonGroup.nextElementSibling)) {}\n\n    showReasons(e.target, false)\n  })\n\n  $(document).on('click', 'button#event-editor-form-saveBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    saveForm(data, timestamp);\n  })\n\n  $(document).on('click', 'button#event-editor-form-splitBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    $('.event-split-form-modal').remove()\n    showSplitForm(data, rowData, nextData)\n  })\n}\n\nfunction checkEquipment(data) {\n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n    //check for equipment input\n\n  if (!isEquipmentValid(equipment)) { \n    //equipment can be empty but if it's not empty it must be the same with the original one to ensure consistency\n    if (equipment !== \"\") { \n      utils.alert('warning', 'Warning', 'Equipment not found, please select it from the list or leave it empty')\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction isEquipmentValid(equipment) {\n  \n  const equip = equipmentRes.reduce((arr, e) => {\n    const text = e.production_line + ' | ' + e.equipment    \n    arr.push(text)\n    return arr\n  }, [])\n  if (equip.indexOf(equipment) === -1) {\n    return false\n  }\n  return true\n}\n\nfunction removeListeners () {\n  $(document).off('change', 'input[type=radio][name=category]')\n  $(document).off('change', \"input[type=radio][name*='reasons-']\")\n  $(document).off('click', 'button#event-editor-form-saveBtn')\n  $(document).off('click', 'button#event-editor-form-splitBtn')\n}\n\n/**\n * Remove Div named 'switch-field', which is one level of reasons\n */\nfunction removeNext (next) {\n  if (next.className === 'switch-field') {\n    next.remove()\n    return true\n  } else {\n    return false\n  }\n}"]}