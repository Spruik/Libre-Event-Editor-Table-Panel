{"version":3,"sources":["../src/form_ctrl.js"],"names":["saveForm","data","timestamp","ctrl","isReadyToWriteInData","utils","alert","equipment","filter","d","name","value","category","comment","length","reasons","includes","reduce","arr","r","push","reason","join","parentReason","line","writeInfluxLine","url","influxHost","post","then","$","trigger","refreshPanel","catch","console","log","e","measurement","getQueryMeasurement","addSlash","rowData","Site","Area","Line","stopped","idle","execute","held","complete","undefined","status","machinestate","actual_rate","rid_1","duration","showForm","reason_code_endp","getReasonCodeEndPoint","influxUrl","postgresUrl","postgRestHost","get","res","result","handleData","equipmentUrl","equipEndp","equipmentRes","categoryRes","popUpOptionModal","removeOptionListeners","addOptionListeners","appEvents","emit","src","modalClass","model","document","off","on","target","id","popUpModal","removeListeners","addListeners","processedData","processData","removeRequestListeners","addRequestListeners","text","val","requestComment","camApi","postMsg","rowdata","time","moment","format","area","site","split","eventComment","retryTimes","showCate","setTimeout","showCategories","categories","cat","category_id","reason_id","parent_reason_id","categoriesGroup","forEach","append","renderCategory","c","insertBefore","inArray","slider","min","max","enableInstantSearch","showEmptyMsg","group","influxRes","results","series","cols","columns","vals","values","o","row","i","nextData","equipmentEndp","getEquipmentEndPoint","input_container","input","radio_tile_group","label","showReasons","isFirstLevel","level","upperReasonsGroup","currentCategorySelected","parseInt","parentElement","rea","reasonsGroup","separator","title","renderReason","insertAfter","appendTarget","checkSelectedReasons","config_reasons","selectedReasons","remove","reasonGroup","removeNext","nextElementSibling","serializeArray","checkEquipment","showSplitForm","isEquipmentValid","equip","production_line","indexOf","next","className"],"mappings":"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","file":"form_ctrl.js","sourcesContent":["import { appEvents } from 'app/core/core'\nimport { showSplitForm } from './split_event_form'\nimport * as utils from './utils'\nimport * as camApi from './camundaAPI'\nimport moment from 'moment'\nimport { enableInstantSearch } from './instant_search_ctrl'\nimport slider from './libs/bootstrap-slider'\nimport { refreshPanel } from './table_ctrl'\nimport * as ctrl from './table_ctrl'\n\nlet categoryRes\nlet equipmentRes\nlet rowData = {}\nlet nextData;\nlet currentCategorySelected\n\nfunction saveForm (data, timestamp) {\n\n  if (!ctrl.isReadyToWriteInData()) {\n    utils.alert('error', 'Error', \"The measurement you put in the Down Time Panel may be invalid, please make sure it matches the one that's in the query\")\n    return\n  }\n  \n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n\n  const category = data.filter(d => d.name === 'category')\n  \n  const comment = data.filter(d => d.name === 'comment')[0].value\n  \n  if (!category.length > 0) {\n    utils.alert('warning', 'Warning', 'Please select a category')\n    return\n  }\n  let reasons = data.filter(d => d.name.includes('reasons-'))\n  reasons = reasons.reduce((arr, r) => {\n    arr.push(r.value)\n    return arr\n  }, [])\n  const reason = reasons.join(' | ')\n  const parentReason = reasons[0]\n\n  const line = writeInfluxLine(category[0].value, parentReason, reason, comment, timestamp, equipment)\n//   console.log(line);\n  \n  let url = utils.influxHost + 'write?db=smart_factory'\n  utils.post(url, line)\n    .then(res => {\n    //   console.log(res)\n      //save success. close the form\n      $('#event-editor-form-cancelBtn').trigger('click')\n      utils.alert('success', 'Success', 'form saved')\n      refreshPanel()\n    })\n    .catch(e => {\n      console.log(e)\n      utils.alert('error', 'Error', `Unexpected error occurred whiling saving the form due to '${e}', please try again`)\n    })\n}\n\n/**\n * Write query line to update the selected record influxdb\n */\nfunction writeInfluxLine (category, parentReason, reason, comment, timestamp, equipment) {\n  const measurement = ctrl.getQueryMeasurement()\n  let line = measurement + ',Site=' + utils.addSlash(rowData.Site, ' ') + ',Area='  + utils.addSlash(rowData.Area, ' ') + ',Line=' + utils.addSlash(rowData.Line, ' ') + ' '\n\n  line += 'stopped=' + rowData.stopped + ','\n  line += 'idle=' + rowData.idle + ','\n  line += 'execute=' + rowData.execute + ','\n  line += 'held=' + rowData.held + ','\n\n  if(rowData.complete !== null && rowData.complete !== undefined) {\n    line += 'complete=' + rowData.complete + ','\n  }\n\n  if (rowData.status !== null && rowData.status !== undefined) {\n    line += 'status=\"' + rowData.status + '\"' + ','\n  }\n\n  if (rowData.machinestate !== null && rowData.machinestate !== undefined) {\n    line += 'MachineState=\"' + rowData.machinestate + '\"' + ','\n  }\n\n  if (rowData.actual_rate !== null && rowData.actual_rate !== undefined) {\n    line += 'actual_rate=' + rowData.actual_rate + ','\n  }\n\n  if (rowData.rid_1 !== null && rowData.rid_1 !== undefined) {\n    line += 'rid_1=\"' + rowData.rid_1 + '\"' + ','\n  }\n\n  if (rowData.duration !== null && rowData.duration !== undefined) {\n    line += 'duration=\"' + rowData.duration + '\"' + ','\n  }\n  if (comment !== '' && comment !== undefined) {\n    line += 'comment=\"' + comment + '\"' + ','\n  }\n  if (equipment !== '' && equipment !== undefined) {\n    line += 'equipment=\"' + equipment + '\"' + ','\n  }\n  line += 'parentReason=\"' + parentReason + '\"' + ','\n  line += 'category=\"' + category + '\"' + ','\n  line += 'reason=\"' + reason + '\"' + ' '\n  line += timestamp\n\n//   console.log(line);\n  return line\n}\n\n/**\n * Send query req to influxdb and postgresql in order to show form contents.\n */\nexport function showForm (timestamp) {\n  //console.log(timestamp)\n  const measurement = ctrl.getQueryMeasurement()\n  const reason_code_endp = ctrl.getReasonCodeEndPoint()\n  let influxUrl = utils.influxHost + `query?pretty=true&db=smart_factory&q=select * from ${measurement} where time >= ${timestamp} limit 2`\n  let postgresUrl = utils.postgRestHost + reason_code_endp\n\n  // send query requests\n  utils.get(influxUrl).then((res) => {\n    const result = handleData(res)\n    console.log(result)\n    const equipmentUrl = result[0]\n    const equipEndp = result[1]\n    utils.get(equipmentUrl).then(res => {\n      equipmentRes = res\n      utils.get(postgresUrl).then(res => {\n        categoryRes = res\n        popUpOptionModal(timestamp)\n      }).catch(e => {\n        utils.alert('error', 'Error', `${reason_code_endp} is not a valid data source, please double check the table name`)\n        console.log(e)\n      })\n    }).catch(e => {\n      utils.alert('error', 'Error', `${equipEndp} is not a valid data source, please double check the table name`)\n      console.log(e)\n    })\n  }).catch(e => {\n    utils.alert('error', 'Error', 'Unexpected error occurred whiling getting data from influxdb, please try again')\n    console.log(e)\n  })\n\n  // remove all listeners\n  removeOptionListeners()\n  // add listeners\n  addOptionListeners(timestamp)\n}\n\nfunction popUpOptionModal () {\n  appEvents.emit('show-modal', {\n    src: 'public/plugins/smart-factory-event-editor-table-panel/partials/popup_options_form.html',\n    modalClass: 'editOrMaintenance-modal',\n    model: {}\n  })\n}\n\nfunction removeOptionListeners() {\n  $(document).off('click', 'input[type=\"radio\"][name=\"edit-maintain-radio\"]')\n}\n\nfunction addOptionListeners(timestamp) {\n\n  $(document).on('click', 'input[type=\"radio\"][name=\"edit-maintain-radio\"]', e => {\n    \n    if (e.target.id === 'edit') {\n      //popup editor\n      popUpModal(timestamp)\n      // remove all listeners\n      removeListeners()\n      // add listeners\n      addListeners(timestamp)\n    }else if (e.target.id === 'maintain') {\n      //if no data, tell the user and open up the editor\n      if (!rowData.category) {\n        utils.alert('warning', 'Reason Codes Not Found', 'Please specify reason codes for this event before requesting maintenance')\n        //popup editor\n        popUpModal(timestamp)\n        // remove all listeners\n        removeListeners()\n        // add listeners\n        addListeners(timestamp)\n      }else {\n        //if there is data\n        const processedData = processData(rowData)\n        appEvents.emit('show-modal', {\n          src: 'public/plugins/smart-factory-event-editor-table-panel/partials/maintenanceRequestComment.html',\n          modalClass: 'confirm-modal',\n          model: {}\n        })\n        // remove all listeners\n        removeRequestListeners()\n        // add listeners\n        addRequestListeners(processedData)\n      }\n    }\n  })\n}\n\nfunction removeRequestListeners() {\n  $(document).off('click', 'button#event-editor-form-maintenance-request-sendBtn')\n}\n\nfunction addRequestListeners(processedData) {\n  $(document).on('click', 'button#event-editor-form-maintenance-request-sendBtn', function (){\n    const text = $('#edit-maintenance-request-text').val()\n    processedData.requestComment = text\n    camApi.postMsg(processedData)\n    $('#edit-maintenance-request-comment-close-btn').trigger('click')\n  })\n}\n\nfunction processData (rowdata) {\n  const time = moment(rowdata.time).format('YYYY-MM-DD HH:mm:ss')\n  const equipment = rowdata.equipment || \"Unknown | Unknown\"\n  const reason = rowdata.reason || \"Unknown\"\n  const comment = rowdata.comment || \"\"\n\n  return {\n    area: rowdata.Area,\n    site: rowdata.Site,\n    line: rowdata.Line,\n    category: rowdata.category,\n    duration: rowdata.duration.split('.')[0],\n    equipment: equipment.split(' | ')[1],\n    reason: reason,\n    status: rowdata.status,\n    eventComment: comment,\n    time: time\n  }\n}\n\n/**\n * Popup the event editor form modal and pass the timestamp into the html as for the form_id\n * and then show categories\n */\nlet retryTimes = 1\nfunction popUpModal (timestamp) {\n  appEvents.emit('show-modal', {\n    src: 'public/plugins/smart-factory-event-editor-table-panel/partials/event_editor_form.html',\n    modalClass: 'confirm-modal event-editor-form-modal scroll',\n    model: { timestamp: timestamp }\n  })\n\n  // set timeout to make sure the DOM exist in order to append categories\n  retryTimes = 1\n  showCate()\n}\n\nfunction showCate(){\n  setTimeout(() => {\n    try{\n      showCategories()\n    }catch (e) {\n      console.log(e);\n      if (retryTimes > 15) {\n        $('#event-editor-form-cancelBtn').trigger('click')\n        utils.alert('error', 'Error', 'Editor Form init failed due to the form trying to initialise and at the same time the page being refreshing, please try agian')\n      }else {\n        // console.log('Editor Form init failed due to the page being refreshing, re-initialising...the ' + retryTimes + 'th time');\n        showCate()\n        retryTimes ++\n      }\n    }\n  }, 200);\n}\n\n/**\n * As the modal is popped up, meaning that the html DOM is now existing. Show content dynamically based on categoryRes\n * And then add\n */\nfunction showCategories () {\n  // category is the top level, there shouldn't be reason_id and parent_reason_id\n  let categories = categoryRes.filter(\n    cat =>\n      cat.category_id !== null &&\n      cat.reason_id === null &&\n      cat.parent_reason_id === null\n  )\n  categories = categories.reduce((arr, cat) => {\n    arr.push(cat.category_id)\n    return arr\n  }, [])\n  let categoriesGroup = $('<div class=\"radio-tile-group\"></div>')\n  categories.forEach(c => {\n    categoriesGroup.append(renderCategory(c))\n  })\n  let target = $('div.target-being-below-categories')\n  categoriesGroup.insertBefore(target)\n  //console.log(categories)\n\n  // check if category already exist, if yes, select it\n  if (rowData.category !== null) {\n    // check if category in categories arr\n    if ($.inArray(rowData.category, categories) !== -1) {\n      // inArray function returns -1 if false, !== -1 means it exists\n      $('input[type=radio][name=category][value=' + '\"' + rowData.category + '\"' + ']').trigger('click')\n    }\n  }\n\n  //display comment if there is\n  if (rowData.comment !== null && rowData.comment !== undefined && rowData.comment !== '') {\n    $('#editor-form-comment-area').text(rowData.comment)\n  }\n\n  //just for testing if the form can start successfully, \n  //if not, the slider.on will thorw err, then will catch it to restart the form\n  let slider = $('#event-split-slider1').slider({\n    min: 1,\n    max: 20,\n    value: 18,\n  })\n  slider.on('change', obj => {\n  })\n\n  if (rowData.equipment !== \"\" && rowData.equipment !== null && rowData.equipment !== undefined) {\n    $('input#eet-datalist-input-equipment').val(rowData.equipment)\n  }\n\n  //init the datalist for equipment\n  enableInstantSearch(equipmentRes)\n\n  if (categoryRes.length === 0) {\n    showEmptyMsg()\n  }\n}\n\nfunction showEmptyMsg(){\n  $('div#category-div-id').text('')\n  let group = $('<p>No reason codes were found, you can add reason codes from the <strong>Reason Codes Tree Panel</strong></p>')\n  let target = $('div.target-being-below-categories')\n  group.insertBefore(target)\n}\n\n/**\n * Make the response row data from the influxdb into one single object for better use\n * Then use the site, area and line attr from the rowData as the keys to get make up a query url then retrun it\n */\nfunction handleData (res) {\n  let influxRes = res.results[0].series[0]\n  let cols = influxRes.columns\n  let vals = influxRes.values\n  let data = []\n  for (let o = 0; o < vals.length; o++) {\n    let row = {}\n    for (let i = 0; i < cols.length; i++) {\n      row[cols[i]] = vals[o][i]\n    }\n    data.push(row)\n  }\n  rowData = data[0]\n  nextData = data.length === 2 ? data[1] : {}\n  // console.log('next record is empty ? --> ' + $.isEmptyObject(nextData))\n  const equipmentEndp = ctrl.getEquipmentEndPoint()\n  let equipmentUrl = utils.postgRestHost + `${equipmentEndp}?production_line=eq.${rowData.Line}&equipment=not.is.null`\n  return [equipmentUrl, equipmentEndp]\n}\n\n/**\n * Make up a single category box with the category passed in, and then return the box.\n */\nfunction renderCategory (category) {\n  let input_container = $('<div class=\"input-container categories-input-container\">')\n  let input = $('<input id=\"' + category + '\" class=\"radio-button\" type=\"radio\" name=\"category\" value=\"' + category + '\" />')\n  let radio_tile_group = $('<div class=\"radio-tile\"></div>')\n  let label = $('<label for=\"' + category + '\" class=\"radio-tile-label\">' + category + '</label>')\n\n  radio_tile_group.append(label)\n  input_container.append(input).append(radio_tile_group)\n\n  return input_container\n}\n\n/**\n * Show the reasons\n * and then append to the DOM\n * NOTE: if is first, target var passed in is a string. else, target passed in is an object\n */\nfunction showReasons (target, isFirstLevel) {\n  let reasons\n  let level\n  let upperReasonsGroup\n\n  if (isFirstLevel) {\n    // is the first level\n    // category = target, reasonid !== null and parentid === null\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === target &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === null\n    )\n    level = 1\n  } else {\n    // is lower level\n    // category = global_currentCategorySelected, reasonsid !== null and parentid === target.value\n    reasons = categoryRes.filter(\n      cat =>\n        cat.category_id === currentCategorySelected &&\n        cat.reason_id !== null &&\n        cat.parent_reason_id === target.value\n    )\n    // level +1 based on the upper one\n    level = parseInt(target.name.split('-')[1]) + 1\n    upperReasonsGroup = target.parentElement.parentElement\n  }\n\n  reasons = reasons.reduce((arr, rea) => {\n    arr.push(rea.reason_id)\n    return arr\n  }, [])\n  //console.log(reasons)\n\n  if (reasons.length === 0) return\n\n  let reasonsGroup = $('<div class=\"switch-field\"></div>')\n\n  if (level !== 1) {\n    let separator = $('<div class=\"custom-separator\"></div>')\n    reasonsGroup.append(separator)\n  }\n\n  let title = $('<div class=\"switch-title\">Reason Level ' + level + '</div>')\n  reasonsGroup.append(title)\n\n  reasons.forEach(r => {\n    reasonsGroup.append(renderReason(r, level))\n  })\n\n  if (level !== 1) {\n    reasonsGroup.insertAfter(upperReasonsGroup)\n  } else {\n    let appendTarget = $('div.target-being-above-reason-level-1')\n    reasonsGroup.insertAfter(appendTarget)\n  }\n\n  checkSelectedReasons(level, reasons)\n}\n\n/**\n * Check if there is reasons that are already selected for each level\n * If there is seleceted reason and for that level, it can be found in the config reason arr, then trigger click\n */\nfunction checkSelectedReasons (level, config_reasons) {\n  // make sure the current selected category is the same with the recorded category to avoid unwanted results\n  if (currentCategorySelected === rowData.category) {\n    if (rowData.reason !== null) {\n      let selectedReasons = rowData.reason.split(' | ')\n      if (selectedReasons[level - 1] !== null) {\n        if ($.inArray(selectedReasons[level - 1], config_reasons) !== -1) {\n          $(`input[type=radio][name*='reasons-'][value=` + '\"' + selectedReasons[level - 1] + '\"' + `]`).trigger('click')\n        }\n      }\n    }\n  }\n}\n\n/**\n * Make up a single reason option with the reason passed in, and then return the option.\n */\nfunction renderReason (reason, level) {\n  let id = level + '-' + reason\n  let group = $('<div></div>')\n  let input = $('<input type=\"radio\" id=\"' + id + '\" name=\"reasons-' + level + '\" value=\"' + reason + '\"/>')\n  let label = $('<label for=\"' + id + '\">' + reason + '</label>')\n  group.append(input).append(label)\n  return group\n}\n\n/**\n * Add listener for categories and reasons\n */\nfunction addListeners (timestamp) {\n  // categories on selected, find reasons where cate_id = this.value && parent_id === null\n  $(document).on('change', 'input[type=radio][name=category]', e => {\n    // console.log(e.target.value)\n    currentCategorySelected = e.target.value\n    // must remove all reasons before show reasons\n    $('div.switch-field').remove()\n    showReasons(e.target.value, true)\n  })\n\n  $(document).on('change', \"input[type=radio][name*='reasons-']\", e => {\n    // console.log(e.target.value);\n\n    // before show reasons, must remove all reason levels that are below this target reason level\n    let reasonGroup = e.target.parentElement.parentElement\n    // Remove reason level one level by one level until it return false.\n    while (removeNext(reasonGroup.nextElementSibling)) {}\n\n    showReasons(e.target, false)\n  })\n\n  $(document).on('click', 'button#event-editor-form-saveBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    saveForm(data, timestamp);\n  })\n\n  $(document).on('click', 'button#event-editor-form-splitBtn', function (){\n    let data = $('form#'+timestamp).serializeArray()\n    if (!checkEquipment(data)){ return }\n    $('.event-split-form-modal').remove()\n    showSplitForm(data, rowData, nextData)\n  })\n}\n\nfunction checkEquipment(data) {\n  const equipment = data.filter(d => d.name === 'equipment')[0].value\n    //check for equipment input\n\n  if (!isEquipmentValid(equipment)) { \n    //equipment can be empty but if it's not empty it must be the same with the original one to ensure consistency\n    if (equipment !== \"\") { \n      utils.alert('warning', 'Warning', 'Equipment not found, please select it from the list or leave it empty')\n      return false\n    }\n  }\n\n  return true\n}\n\nfunction isEquipmentValid(equipment) {\n  \n  const equip = equipmentRes.reduce((arr, e) => {\n    const text = e.production_line + ' | ' + e.equipment    \n    arr.push(text)\n    return arr\n  }, [])\n  if (equip.indexOf(equipment) === -1) {\n    return false\n  }\n  return true\n}\n\nfunction removeListeners () {\n  $(document).off('change', 'input[type=radio][name=category]')\n  $(document).off('change', \"input[type=radio][name*='reasons-']\")\n  $(document).off('click', 'button#event-editor-form-saveBtn')\n  $(document).off('click', 'button#event-editor-form-splitBtn')\n}\n\n/**\n * Remove Div named 'switch-field', which is one level of reasons\n */\nfunction removeNext (next) {\n  if (next.className === 'switch-field') {\n    next.remove()\n    return true\n  } else {\n    return false\n  }\n}"]}