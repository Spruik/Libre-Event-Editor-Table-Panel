{"version":3,"sources":["../src/table_ctrl.js"],"names":["_","$","moment","FileExport","MetricsPanelCtrl","transformDataToTable","utils","tablePanelEditor","columnOptionsTab","TableRenderer","FormOptionCtrl","_ctrl","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","headerColor","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","durationFilter","hideExecute","reasonCodeEndPoint","equipmentEndPoint","endPoint","TableCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv","$sce","pageIndex","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","camundaUrl","trustAsResourceUrl","camundaHost","measurementOK","document","off","rawData","map","index","td","childNodes","length","nodeValue","text","timeIndex","ctrl","colDimensions","indexOf","alert","date","timestamp","valueOf","show","errorLogged","durationMissingErrorLogged","postgresConnectionErrorLogged","parentUpdated","addEditorTab","actions","push","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","annotations","data","err","dataRaw","render","dataList","handle","filterExecute","isNaN","filterDuration","checkEndPoint","filteredData","undefined","indexOfexecute","findIndex","x","toLowerCase","filteredRows","rows","filter","row","minDur","minDurVal","duration","allData","parseData","_to","to","isAfter","splice","_prevTime","i","diff","format","getDuration","durationFormat","console","log","cols","k","records","record","key","influxUrl","influxHost","get","res","results","series","includes","catch","difference","milSecs","parseInt","daysDiff","Math","floor","hrsDiff","minsDiff","slice","secsDiff","timeToAdd","durationInt","measurement","line","addSlash","site","area","stopped","idle","execute","held","complete","status","machinestate","actual_rate","rid","MachineState","parentReason","category","reason","time","split","table","renderer","isTimezoneUtc","colIndex","scope","$new","tableData","render_values","publishAppEvent","templateHtml","modalClass","elem","attrs","pageCount","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","e","el","currentTarget","renderPanel","appendPaginationControls","footerElem","ceil","startPage","max","endPage","min","paginationList","activeClass","pageLinkElem","append","panelElem","parents","rootElem","find","css","addClass","hidden","tooltip","selector","addFilterClicked","filterData","options","column","value","operator","setAdhocFilter","unbindDestroy","$on","renderData","renderingCompleted","refreshPanel","refresh","getQueryMeasurement","getReasonCodeEndPoint","getEquipmentEndPoint","isReadyToWriteInData","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport * as FileExport from 'app/core/utils/file_export';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport { transformDataToTable } from './transformers';\nimport * as utils from './utils';\nimport { tablePanelEditor } from './editor';\nimport { columnOptionsTab } from './column_options';\nimport { TableRenderer } from './renderer';\nimport { FormOptionCtrl } from './form_option_ctrl';\n\nimport './css/style.css!';\nimport './css/bootstrap-slider.css!';\nimport './css/instant-search.css!';\n\nlet _ctrl;\n\nconst panelDefaults = {\n\ttargets: [ {} ],\n\ttransform: 'timeseries_to_columns',\n\tpageSize: null,\n\tshowHeader: true,\n\tstyles: [\n\t\t{\n\t\t\ttype: 'date',\n\t\t\tpattern: 'Time',\n\t\t\talias: 'Time',\n\t\t\tdateFormat: 'YYYY-MM-DD HH:mm:ss.SSS',\n\t\t\theaderColor: 'rgba(51, 181, 229, 1)'\n\t\t},\n\t\t{\n\t\t\tunit: 'short',\n\t\t\ttype: 'number',\n\t\t\talias: '',\n\t\t\tdecimals: 2,\n\t\t\theaderColor: 'rgba(51, 181, 229, 1)',\n\t\t\tcolors: [ 'rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)' ],\n\t\t\tcolorMode: null,\n\t\t\tpattern: '/.*/',\n\t\t\tthresholds: []\n\t\t}\n\t],\n\tcolumns: [],\n\tscroll: true,\n\tfontSize: '100%',\n\tsort: { col: 0, desc: true },\n\tdurationFilter: 3,\n\thideExecute: true,\n\treasonCodeEndPoint: 'reason_code',\n\tequipmentEndPoint: 'equipment',\n\tendPoint: 'Availability'\n};\n\nexport class TableCtrl extends MetricsPanelCtrl {\n\tconstructor($scope, $injector, templateSrv, annotationsSrv, $sanitize, variableSrv, $sce) {\n\t\tsuper($scope, $injector);\n\n\t\tthis.pageIndex = 0;\n\n\t\tif (this.panel.styles === void 0) {\n\t\t\tthis.panel.styles = this.panel.columns;\n\t\t\tthis.panel.columns = this.panel.fields;\n\t\t\tdelete this.panel.columns;\n\t\t\tdelete this.panel.fields;\n\t\t}\n\n\t\t_.defaults(this.panel, panelDefaults);\n\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\t\tthis.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n\n\t\tthis.panel.camundaUrl = $sce.trustAsResourceUrl(utils.camundaHost);\n\t\tthis.panel.measurementOK = false;\n\n\t\t$(document).off('click', 'tr.tr-affect#event-editor-table-tr-id');\n\t\t//Show form if a row is clicked\n\t\t$(document).on('click', 'tr.tr-affect#event-editor-table-tr-id', function() {\n\t\t\tconst rawData = $('td', this).map((index, td) => {\n\t\t\t\tif (td.childNodes.length === 2) {\n\t\t\t\t\treturn td.childNodes[1].nodeValue;\n\t\t\t\t} else if (td.childNodes.length === 1) {\n\t\t\t\t\treturn $(td).text();\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst timeIndex = $scope.ctrl.colDimensions.indexOf('time');\n\t\t\tif (!~timeIndex) {\n\t\t\t\tutils.alert(\n\t\t\t\t\t'error',\n\t\t\t\t\t'Error',\n\t\t\t\t\t'Get not get this event from the database because TIME NOT FOUND, please contact the dev team, or try to NOT hide the time column'\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tconst date = rawData[timeIndex];\n\t\t\t\tconst timestamp = moment(date).valueOf() * 1000000;\n\t\t\t\tnew FormOptionCtrl($scope.ctrl, timestamp).show();\n\t\t\t}\n\t\t});\n\n\t\tthis.errorLogged = false;\n\t\tthis.durationMissingErrorLogged = false;\n\t\tthis.postgresConnectionErrorLogged = false;\n\t\tthis.parentUpdated = false;\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', tablePanelEditor, 2);\n\t\tthis.addEditorTab('Column Styles', columnOptionsTab, 3);\n\t}\n\n\tonInitPanelActions(actions) {\n\t\tactions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\n\t}\n\n\tissueQueries(datasource) {\n\t\tthis.pageIndex = 0;\n\n\t\tif (this.panel.transform === 'annotations') {\n\t\t\tthis.setTimeQueryStart();\n\t\t\treturn this.annotationsSrv\n\t\t\t\t.getAnnotations({\n\t\t\t\t\tdashboard: this.dashboard,\n\t\t\t\t\tpanel: this.panel,\n\t\t\t\t\trange: this.range\n\t\t\t\t})\n\t\t\t\t.then((annotations) => {\n\t\t\t\t\treturn { data: annotations };\n\t\t\t\t});\n\t\t}\n\n\t\treturn super.issueQueries(datasource);\n\t}\n\n\tonDataError(err) {\n\t\tthis.dataRaw = [];\n\t\tthis.render();\n\t}\n\n\tonDataReceived(dataList) {\n\t\tif (dataList.length !== 0) {\n\t\t\tthis.handle(dataList[0]);\n\t\t}\n\n\t\tif (this.panel.hideExecute) {\n\t\t\tif (dataList.length !== 0) {\n\t\t\t\tdataList = this.filterExecute(dataList);\n\t\t\t}\n\t\t}\n\n\t\t// filter shorter duration\n\t\tif (dataList.length !== 0) {\n\t\t\tif (this.panel.durationFilter) {\n\t\t\t\tif (isNaN(this.panel.durationFilter)) {\n\t\t\t\t\tthis.panel.durationFilter = 3;\n\t\t\t\t}\n\t\t\t\tdataList = this.filterDuration(this.panel.durationFilter, dataList);\n\t\t\t}\n\t\t}\n\n\t\tthis.dataRaw = dataList;\n\t\tthis.pageIndex = 0;\n\t\t// automatically correct transform mode based on data\n\t\tif (this.dataRaw && this.dataRaw.length) {\n\t\t\tif (this.dataRaw[0].type === 'table') {\n\t\t\t\tthis.panel.transform = 'table';\n\t\t\t} else {\n\t\t\t\tif (this.dataRaw[0].type === 'docs') {\n\t\t\t\t\tthis.panel.transform = 'json';\n\t\t\t\t} else {\n\t\t\t\t\tif (this.panel.transform === 'table' || this.panel.transform === 'json') {\n\t\t\t\t\t\tthis.panel.transform = 'timeseries_to_rows';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.checkEndPoint(this.panel.endPoint);\n\t\tthis.render();\n\t}\n\n\tfilterExecute(data) {\n\t\tlet filteredData;\n\t\tif (data[0].columns !== null && data[0].columns !== undefined) {\n\t\t\tlet indexOfexecute = data[0].columns.findIndex((x) => x.text.toLowerCase() === 'execute');\n\t\t\tlet filteredRows = data[0].rows.filter((row) => row[indexOfexecute] !== 1);\n\t\t\tdata[0].rows = filteredRows;\n\t\t}\n\t\tfilteredData = data;\n\t\treturn filteredData;\n\t}\n\n\tfilterDuration(minDur, data) {\n\t\tconst minDurVal = moment.duration(minDur, 'minutes').valueOf();\n\t\tlet filteredData;\n\t\tif (data[0].columns !== null && data[0].columns !== undefined) {\n\t\t\tlet index = data[0].columns.findIndex((x) => x.text.toLowerCase() === 'durationvalue');\n\t\t\tif (!~index) {\n\t\t\t\treturn data;\n\t\t\t}\n\t\t\tlet filteredRows = data[0].rows.filter((row) => row[index] >= minDurVal);\n\t\t\tdata[0].rows = filteredRows;\n\t\t}\n\t\tfilteredData = data;\n\t\treturn filteredData;\n\t}\n\n\thandle(data) {\n\t\tif (data !== undefined) {\n\t\t\tif (data.type === 'table') {\n\t\t\t\tthis.allData = this.parseData(data.columns, data.rows);\n\n\t\t\t\tconst _to = this.range.to.isAfter(moment()) ? moment() : this.range.to;\n\n\t\t\t\tdata.columns.splice(1, 0, { text: 'Duration' });\n\t\t\t\tdata.columns.splice(2, 0, { text: 'DurationValue' });\n\n\t\t\t\tlet _prevTime = null;\n\t\t\t\tfor (let i = data.rows.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst row = data.rows[i];\n\t\t\t\t\tif (i === data.rows.length - 1) {\n\t\t\t\t\t\t// first one\n\t\t\t\t\t\tconst diff = _to.diff(moment(row[0]));\n\t\t\t\t\t\tconst duration = moment.duration(diff);\n\t\t\t\t\t\tconst format = this.getDuration(diff);\n\t\t\t\t\t\tdata.rows[i].splice(1, 0, format);\n\t\t\t\t\t\tdata.rows[i].splice(2, 0, duration.valueOf());\n\t\t\t\t\t\tthis.allData[i].duration = duration;\n\t\t\t\t\t\tthis.allData[i].durationFormat = format;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst diff = _prevTime.diff(row[0]);\n\t\t\t\t\t\tconst duration = moment.duration(diff);\n\t\t\t\t\t\tconst format = this.getDuration(diff);\n\t\t\t\t\t\tdata.rows[i].splice(1, 0, format);\n\t\t\t\t\t\tdata.rows[i].splice(2, 0, duration.valueOf());\n\t\t\t\t\t\tthis.allData[i].duration = duration;\n\t\t\t\t\t\tthis.allData[i].durationFormat = format;\n\t\t\t\t\t}\n\t\t\t\t\t_prevTime = moment(row[0]);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//The table format is not TABLE\n\t\t\t\tif (!this.errorLogged) {\n\t\t\t\t\tconsole.log('To calculate the duration of each event, please format the data as a TABLE');\n\t\t\t\t}\n\t\t\t\tthis.errorLogged = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tparseData(cols, rows) {\n\t\tcols = cols.map((x) => x.text.toLowerCase());\n\t\tlet data = [];\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tlet row = {};\n\t\t\tfor (let k = 0; k < cols.length; k++) {\n\t\t\t\trow[cols[k]] = rows[i][k];\n\t\t\t}\n\t\t\tdata.push(row);\n\t\t}\n\t\treturn data;\n\t}\n\n\tgetRecords(cols, rows) {\n\t\tlet records = [];\n\t\tfor (let i = 0; i < rows.length; i++) {\n\t\t\tconst row = rows[i];\n\t\t\tlet record = {};\n\t\t\tfor (let k = 0; k < cols.length; k++) {\n\t\t\t\tconst col = cols[k];\n\t\t\t\trecord[col] = row[k];\n\t\t\t}\n\t\t\trecords.push(record);\n\t\t}\n\t\treturn records;\n\t}\n\n\tcheckEndPoint(key) {\n\t\tlet influxUrl = utils.influxHost + `query?pretty=true&db=smart_factory&q=select * from ${key} limit 1`;\n\t\tutils\n\t\t\t.get(influxUrl)\n\t\t\t.then((res) => {\n\t\t\t\tif (!res.results[0].series) {\n\t\t\t\t\tthis.panel.measurementOK = false;\n\t\t\t\t\tutils.alert(\n\t\t\t\t\t\t'error',\n\t\t\t\t\t\t'Error',\n\t\t\t\t\t\t\"The measurement you put in the Down Time Panel may be invalid, please make sure it matches the one that's in the query\"\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t// console.log(res)\n\t\t\t\tif (!res.results[0].series[0].columns.includes('held')) {\n\t\t\t\t\tthis.panel.measurementOK = false;\n\t\t\t\t\tutils.alert(\n\t\t\t\t\t\t'error',\n\t\t\t\t\t\t'Error',\n\t\t\t\t\t\t\"The measurement you put in the Down Time Panel may be invalid, please make sure it matches the one that's in the query\"\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.panel.measurementOK = true;\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tthis.panel.measurementOK = false;\n\t\t\t\tutils.alert(\n\t\t\t\t\t'error',\n\t\t\t\t\t'Error',\n\t\t\t\t\t\"The measurement you put in the Down Time Panel may be invalid, please make sure it matches the one that's in the query\"\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t});\n\t}\n\n\tgetDuration(difference) {\n\t\tconst milSecs = parseInt(difference % 1000);\n\n\t\tconst daysDiff = Math.floor(difference / 1000 / 60 / 60 / 24);\n\t\tdifference -= daysDiff * 1000 * 60 * 60 * 24;\n\n\t\tlet hrsDiff = Math.floor(difference / 1000 / 60 / 60);\n\t\tdifference -= hrsDiff * 1000 * 60 * 60;\n\n\t\tconst minsDiff = ('0' + Math.floor(difference / 1000 / 60)).slice(-2);\n\t\tdifference -= minsDiff * 1000 * 60;\n\n\t\tconst secsDiff = ('0' + Math.floor(difference / 1000)).slice(-2);\n\t\tdifference -= minsDiff * 1000;\n\n\t\tlet timeToAdd = daysDiff * 24;\n\t\thrsDiff = hrsDiff + timeToAdd;\n\t\thrsDiff = hrsDiff < 10 ? '0' + hrsDiff : hrsDiff;\n\n\t\treturn hrsDiff + ':' + minsDiff + ':' + secsDiff + '.' + milSecs;\n\t}\n\n\tgetInfluxLine(record, duration, durationInt) {\n\t\tif (!this.panel.measurementOK) {\n\t\t\t// console.log('not writing 1')\n\t\t\treturn;\n\t\t}\n\t\tconst measurement = this.panel.endPoint;\n\t\tlet line =\n\t\t\tmeasurement +\n\t\t\t',Site=' +\n\t\t\tutils.addSlash(record.site, ' ') +\n\t\t\t',Area=' +\n\t\t\tutils.addSlash(record.area, ' ') +\n\t\t\t',Line=' +\n\t\t\tutils.addSlash(record.line, ' ') +\n\t\t\t' ';\n\n\t\tline += 'stopped=' + record.stopped + ',';\n\t\tline += 'idle=' + record.idle + ',';\n\t\tline += 'execute=' + record.execute + ',';\n\t\tline += 'held=' + record.held + ',';\n\n\t\tif (record.complete !== null && record.complete !== undefined) {\n\t\t\tline += 'complete=' + record.complete + ',';\n\t\t}\n\n\t\tif (record.status !== null && record.status !== undefined) {\n\t\t\tline += 'status=\"' + record.status + '\"' + ',';\n\t\t}\n\n\t\tif (record.machinestate !== null && record.machinestate !== undefined) {\n\t\t\tline += 'MachineState=\"' + record.machinestate + '\"' + ',';\n\t\t}\n\n\t\tif (record.actual_rate !== null && record.actual_rate !== undefined) {\n\t\t\tline += 'actual_rate=' + record.actual_rate + ',';\n\t\t}\n\n\t\tif (record.rid !== null && record.rid !== undefined) {\n\t\t\tline += 'rid_1=\"' + record.rid + '\"' + ',';\n\t\t}\n\n\t\tif (record.MachineState !== null && record.MachineState !== undefined) {\n\t\t\tline += 'MachineState=\"' + record.MachineState + '\"' + ',';\n\t\t}\n\n\t\tif (record.parentReason !== null && record.parentReason !== undefined) {\n\t\t\tline += 'parentReason=\"' + record.parentReason + '\"' + ',';\n\t\t}\n\n\t\tif (record.category !== null && record.category !== undefined) {\n\t\t\tline += 'category=\"' + record.category + '\"' + ',';\n\t\t}\n\n\t\tif (record.reason !== null && record.reason !== undefined) {\n\t\t\tline += 'reason=\"' + record.reason + '\"' + ',';\n\t\t}\n\n\t\tline += 'durationInt=' + durationInt + ',';\n\t\tline += 'duration=\"' + duration + '\"' + ' ';\n\n\t\tline += record.time * 1000000;\n\n\t\t// console.log('line1' , line)\n\t\treturn line;\n\t}\n\n\tnormalInfluxLine(record) {\n\t\tif (!this.panel.measurementOK) {\n\t\t\t// console.log('not writing')\n\t\t\treturn;\n\t\t}\n\t\tconst measurement = this.panel.endPoint;\n\t\tlet line =\n\t\t\tmeasurement +\n\t\t\t',Site=' +\n\t\t\tutils.addSlash(record.site, ' ') +\n\t\t\t',Area=' +\n\t\t\tutils.addSlash(record.area, ' ') +\n\t\t\t',Line=' +\n\t\t\tutils.addSlash(record.line, ' ') +\n\t\t\t' ';\n\n\t\tline += 'stopped=' + record.stopped + ',';\n\t\tline += 'idle=' + record.idle + ',';\n\t\tline += 'execute=' + record.execute + ',';\n\t\tline += 'held=' + record.held + ',';\n\n\t\tif (record.complete !== null && record.complete !== undefined) {\n\t\t\tline += 'complete=' + record.complete + ',';\n\t\t}\n\n\t\tif (record.MachineState !== null && record.MachineState !== undefined) {\n\t\t\tline += 'MachineState=\"' + record.MachineState + '\"' + ',';\n\t\t}\n\n\t\tif (record.rid !== null && record.rid !== undefined) {\n\t\t\tline += 'rid=\"' + record.rid + '\"' + ',';\n\t\t}\n\n\t\tif (record.actual_rate !== null && record.actual_rate !== undefined) {\n\t\t\tline += 'actual_rate=' + record.actual_rate + ',';\n\t\t}\n\n\t\tif (record.status !== null && record.status !== undefined) {\n\t\t\tline += 'status=\"' + record.status + '\"' + ',';\n\t\t}\n\n\t\tif (record.category !== null && record.category !== undefined) {\n\t\t\tline += 'category=\"' + record.category + '\"' + ',';\n\t\t}\n\n\t\tif (record.reason !== null && record.reason !== undefined) {\n\t\t\tline += 'reason=\"' + record.reason + '\"' + ',';\n\t\t\tline += 'parentReason=\"' + record.reason.split(' | ')[0] + '\"' + ',';\n\t\t}\n\n\t\tif (record.durationInt !== null && record.durationInt !== undefined) {\n\t\t\tline += 'durationInt=' + record.durationInt + ',';\n\t\t}\n\n\t\tif (record.duration !== null && record.duration !== undefined) {\n\t\t\tline += 'duration=\"' + record.duration + '\"' + ',';\n\t\t}\n\n\t\tline += record.time * 1000000;\n\n\t\t// console.log('line2' , line)\n\n\t\treturn line;\n\t}\n\n\trender() {\n\t\tthis.table = transformDataToTable(this.dataRaw, this.panel);\n\t\t// console.log(this.panel.sort);\n\t\tthis.table.sort(this.panel.sort);\n\t\t// console.log(this.panel.sort);\n\t\tthis.renderer = new TableRenderer(\n\t\t\tthis.panel,\n\t\t\tthis.table,\n\t\t\tthis.dashboard.isTimezoneUtc(),\n\t\t\tthis.$sanitize,\n\t\t\tthis.templateSrv,\n\t\t\tthis.col\n\t\t);\n\n\t\treturn super.render(this.table);\n\t}\n\n\ttoggleColumnSort(col, colIndex) {\n\t\t// remove sort flag from current column\n\t\tif (this.table.columns[this.panel.sort.col]) {\n\t\t\tthis.table.columns[this.panel.sort.col].sort = false;\n\t\t}\n\n\t\tif (this.panel.sort.col === colIndex) {\n\t\t\tif (this.panel.sort.desc) {\n\t\t\t\tthis.panel.sort.desc = false;\n\t\t\t} else {\n\t\t\t\tthis.panel.sort.col = null;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.panel.sort.col = colIndex;\n\t\t\tthis.panel.sort.desc = true;\n\t\t}\n\t\tthis.render();\n\t}\n\n\texportCsv() {\n\t\tconst scope = this.$scope.$new(true);\n\t\tscope.tableData = this.renderer.render_values();\n\t\tscope.panel = 'table';\n\t\tthis.publishAppEvent('show-modal', {\n\t\t\ttemplateHtml: '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\n\t\t\tscope,\n\t\t\tmodalClass: 'modal--narrow'\n\t\t});\n\t}\n\n\tlink(scope, elem, attrs, ctrl) {\n\t\tlet data;\n\t\tconst panel = ctrl.panel;\n\t\tlet pageCount = 0;\n\n\t\tfunction getTableHeight() {\n\t\t\tlet panelHeight = ctrl.height;\n\n\t\t\tif (pageCount > 1) {\n\t\t\t\tpanelHeight -= 26;\n\t\t\t}\n\n\t\t\treturn panelHeight - 31 + 'px';\n\t\t}\n\n\t\tfunction appendTableRows(tbodyElem) {\n\t\t\tctrl.renderer.setTable(data);\n\t\t\ttbodyElem.empty();\n\t\t\ttbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n\t\t}\n\n\t\tfunction switchPage(e) {\n\t\t\tconst el = $(e.currentTarget);\n\t\t\tctrl.pageIndex = parseInt(el.text(), 10) - 1;\n\t\t\trenderPanel();\n\t\t}\n\n\t\tfunction appendPaginationControls(footerElem) {\n\t\t\tfooterElem.empty();\n\n\t\t\tconst pageSize = panel.pageSize || 100;\n\t\t\tpageCount = Math.ceil(data.rows.length / pageSize);\n\t\t\tif (pageCount === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst startPage = Math.max(ctrl.pageIndex - 3, 0);\n\t\t\tconst endPage = Math.min(pageCount, startPage + 9);\n\n\t\t\tconst paginationList = $('<ul></ul>');\n\n\t\t\tfor (let i = startPage; i < endPage; i++) {\n\t\t\t\tconst activeClass = i === ctrl.pageIndex ? 'active' : '';\n\t\t\t\tconst pageLinkElem = $(\n\t\t\t\t\t'<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>'\n\t\t\t\t);\n\t\t\t\tpaginationList.append(pageLinkElem);\n\t\t\t}\n\n\t\t\tfooterElem.append(paginationList);\n\t\t}\n\n\t\tfunction renderPanel() {\n\t\t\tconst panelElem = elem.parents('.panel-content');\n\t\t\tconst rootElem = elem.find('.table-panel-scroll');\n\t\t\tconst tbodyElem = elem.find('tbody');\n\t\t\tconst footerElem = elem.find('.table-panel-footer');\n\n\t\t\telem.css({ 'font-size': panel.fontSize });\n\t\t\tpanelElem.addClass('table-panel-content');\n\n\t\t\tappendTableRows(tbodyElem);\n\t\t\tappendPaginationControls(footerElem);\n\n\t\t\trootElem.css({ 'max-height': panel.scroll ? getTableHeight() : '' });\n\n\t\t\t// get current table column dimensions\n\t\t\tif (ctrl.table.columns) {\n\t\t\t\tctrl.colDimensions = ctrl.table.columns.filter((x) => !x.hidden).map((x) => x.text.toLowerCase());\n\t\t\t}\n\t\t}\n\n\t\t// hook up link tooltips\n\t\telem.tooltip({\n\t\t\tselector: '[data-link-tooltip]'\n\t\t});\n\n\t\tfunction addFilterClicked(e) {\n\t\t\tconst filterData = $(e.currentTarget).data();\n\t\t\tconst options = {\n\t\t\t\tdatasource: panel.datasource,\n\t\t\t\tkey: data.columns[filterData.column].text,\n\t\t\t\tvalue: data.rows[filterData.row][filterData.column],\n\t\t\t\toperator: filterData.operator\n\t\t\t};\n\n\t\t\tctrl.variableSrv.setAdhocFilter(options);\n\t\t}\n\n\t\telem.on('click', '.table-panel-page-link', switchPage);\n\t\telem.on('click', '.table-panel-filter-link', addFilterClicked);\n\n\t\tconst unbindDestroy = scope.$on('$destroy', () => {\n\t\t\telem.off('click', '.table-panel-page-link');\n\t\t\telem.off('click', '.table-panel-filter-link');\n\t\t\tunbindDestroy();\n\t\t});\n\n\t\tctrl.events.on('render', (renderData) => {\n\t\t\tdata = renderData || data;\n\t\t\tif (data) {\n\t\t\t\trenderPanel();\n\t\t\t}\n\t\t\tctrl.renderingCompleted();\n\t\t});\n\t}\n}\n\nexport const refreshPanel = () => {\n\t_ctrl.refresh();\n};\n\nexport const getQueryMeasurement = () => {\n\treturn _ctrl.panel.endPoint;\n};\n\nexport const getReasonCodeEndPoint = () => {\n\treturn _ctrl.panel.reasonCodeEndPoint;\n};\n\nexport const getEquipmentEndPoint = () => {\n\treturn _ctrl.panel.equipmentEndPoint;\n};\n\nexport const isReadyToWriteInData = () => {\n\treturn _ctrl.panel.measurementOK;\n};\n\nTableCtrl.templateUrl = './partials/module.html';\n"]}